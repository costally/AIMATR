<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marathon AI Coach v2.9</title>
    <style>
        :root {
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --bg: #F2F2F7;
            --card: #FFFFFF;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --info-bg: #EEF1F5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--card);
            border-radius: 24px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            padding: 30px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            min-height: 950px;
        }

        /* ê³µí†µ ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .hidden { display: none !important; }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header { text-align: center; margin-bottom: 25px; }
        .badge { background-color: #E5E5EA; color: var(--text-sub); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; }
        h1 { margin: 10px 0 5px 0; font-size: 1.8rem; letter-spacing: -0.5px; }
        .subtitle { font-size: 0.95rem; color: var(--text-sub); margin: 0; }

        /* í¼ ìš”ì†Œ */
        .form-section { margin-bottom: 25px; border-bottom: 1px solid #f2f2f7; padding-bottom: 20px; }
        .form-section:last-of-type { border-bottom: none; }
        .section-title { font-size: 0.9rem; font-weight: 600; color: var(--text-sub); margin-bottom: 10px; text-transform: uppercase; }
        .row { display: flex; gap: 15px; }
        .col { flex: 1; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        
        select, input[type="date"] {
            width: 100%; padding: 14px; border: 1px solid #d1d1d6; border-radius: 12px; font-size: 1rem;
            background: #fff; box-sizing: border-box; -webkit-appearance: none;
        }
        select:focus, input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }

        /* ì»¤ìŠ¤í…€ ì‹œê°„ ì„ íƒê¸° (Scroll Box) */
        .time-picker-group { display: flex; gap: 5px; align-items: center; }
        .time-select-wrapper { flex: 1; position: relative; }
        .time-select-wrapper select { text-align: center; padding-right: 20px; }
        .time-label { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; color: #8e8e93; pointer-events: none; }

        /* ì¶”ì²œ í”„ë¡œê·¸ë¨ ë²„íŠ¼ ê·¸ë£¹ */
        .preset-group { display: flex; gap: 8px; margin-bottom: 15px; }
        .preset-btn {
            flex: 1; padding: 12px 5px; border: 1px solid #d1d1d6; background: white; border-radius: 10px;
            font-size: 0.85rem; font-weight: 600; color: #666; cursor: pointer; transition: 0.2s; line-height: 1.3; position: relative;
        }
        .preset-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .preset-btn:hover:not(.active) { background: #f2f2f7; }
        
        /* ì¶”ì²œ ë±ƒì§€ - ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
        .rec-badge {
            position: absolute; top: -10px; right: -5px; background: #FF3B30; color: white;
            font-size: 0.65rem; padding: 3px 8px; border-radius: 12px; display: none; font-weight: 800;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: 2px solid #fff;
            animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        /* í”¼ë“œë°± ë©”ì‹œì§€ ë°•ìŠ¤ */
        .feedback-box {
            background: #f2f2f7; padding: 15px; border-radius: 12px; margin-top: 10px;
            font-size: 0.9rem; display: flex; flex-direction: column; gap: 5px;
            border-left: 4px solid #ccc; transition: all 0.3s;
        }
        .feedback-box.safe { background: #e8fbf0; border-left-color: var(--success); color: #0c5122; }
        .feedback-box.challenge { background: #fff8e6; border-left-color: var(--warning); color: #7a4f01; }
        .feedback-box.danger { background: #feebeb; border-left-color: var(--danger); color: #c90a00; }
        
        .rec-time-display { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin-top: 5px; }

        /* ê³¼í•™ì  ê·¼ê±° ì•ˆë‚´ ë°•ìŠ¤ */
        .science-info {
            background-color: var(--info-bg);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #555;
            line-height: 1.5;
            border: 1px solid #E1E4E8;
        }
        .science-info strong { color: #333; font-weight: 700; }
        .science-info ul { margin: 5px 0 0 0; padding-left: 20px; }
        .science-info li { margin-bottom: 4px; }

        /* ë©”ì¸ ë²„íŠ¼ (CTA) */
        button.cta {
            width: 100%; background-color: var(--primary); color: white; padding: 16px; border: none; border-radius: 16px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,122,255,0.3);
            margin-top: 10px;
        }
        button.cta:hover { background-color: #0062cc; transform: translateY(-2px); }
        button.secondary-btn {
            width: 100%; background-color: transparent; color: #8e8e93; padding: 12px; border: none; font-weight: 600;
            cursor: pointer; margin-top: 10px;
        }

        /* --- [View 2: Summary] ìŠ¤íƒ€ì¼ --- */
        .summary-card { background: #F2F2F7; padding: 25px; border-radius: 20px; text-align: center; margin-bottom: 25px; }
        .big-stat { font-size: 2.5rem; font-weight: 800; color: var(--primary); display: block; margin-bottom: 5px; }
        .sub-stat { font-size: 1rem; color: #666; }
        .summary-info-row { display: flex; justify-content: center; gap: 15px; margin-top: 15px; color: #666; font-size: 0.9rem; }
        
        .pace-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 30px; }
        .pace-card { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e5e5ea; }
        .pace-label { font-size: 0.8rem; color: #8e8e93; font-weight: 700; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }
        .pace-value { font-size: 1.1rem; font-weight: 700; color: #1c1c1e; }
        .dot { width: 6px; height: 6px; border-radius: 50%; }

        /* --- [View 3: Detail] ìŠ¤íƒ€ì¼ --- */
        .timeline-container { position: relative; padding-left: 20px; border-left: 2px solid #e5e5ea; margin-left: 10px; }
        .phase-card {
            margin-bottom: 20px; padding: 20px; border-radius: 16px; color: white; position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .phase-base { background: linear-gradient(135deg, #34C759, #248A3D); }
        .phase-build { background: linear-gradient(135deg, #FF9500, #CC7700); }
        .phase-peak { background: linear-gradient(135deg, #FF3B30, #C41C00); }
        .phase-taper { background: linear-gradient(135deg, #007AFF, #0055B3); }

        .phase-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .phase-name { font-size: 1.1rem; font-weight: 800; }
        .phase-weeks { background: rgba(255,255,255,0.25); padding: 2px 8px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; }
        .phase-desc { font-size: 0.9rem; opacity: 0.95; line-height: 1.4; }

    </style>
</head>
<body>

    <div class="container">
        <!-- HEADER -->
        <header>
            <span class="badge">AI COACH v2.9</span>
            <h1>Marathon Planner</h1>
            <p class="subtitle" id="pageSubtitle">ë‚˜ë§Œì˜ ë§ì¶¤í˜• í›ˆë ¨ í”„ë¡œê·¸ë¨ ì„¤ì •</p>
        </header>

        <!-- [VIEW 1] ì…ë ¥ í™”ë©´ -->
        <div id="view-home" class="fade-in">
            <form id="runnerForm">
                
                <!-- 1. ê¸°ëŸ‰ ì •ë³´ -->
                <div class="form-section">
                    <div class="section-title">1. Current Fitness (í˜„ì¬ ê¸°ëŸ‰)</div>
                    <div class="row">
                        <div class="col" style="flex: 0.8;">
                            <label>ìµœê·¼ ë‹¬ë¦° ê±°ë¦¬</label>
                            <select id="currentDist" onchange="updateAll()">
                                <option value="5">5km</option>
                                <option value="10" selected>10km</option>
                                <option value="21.0975">í•˜í”„</option>
                                <option value="42.195">í’€ì½”ìŠ¤</option>
                            </select>
                        </div>
                        <div class="col" style="flex: 1.2;">
                            <label>ìµœê·¼ ê¸°ë¡</label>
                            <div class="time-picker-group">
                                <div class="time-select-wrapper">
                                    <select id="curH" onchange="updateAll()"></select><span class="time-label">h</span>
                                </div>
                                <div class="time-select-wrapper">
                                    <select id="curM" onchange="updateAll()"></select><span class="time-label">m</span>
                                </div>
                                <div class="time-select-wrapper">
                                    <select id="curS" onchange="updateAll()"></select><span class="time-label">s</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. ëª©í‘œ ì„¤ì • -->
                <div class="form-section">
                    <div class="section-title">2. Target Goal (ëª©í‘œ ì„¤ì •)</div>
                    <div class="row" style="margin-bottom:10px;">
                        <div class="col" style="flex:0.8">
                            <label>ëª©í‘œ ëŒ€íšŒ</label>
                            <select id="targetDist" onchange="updateAll()">
                                <option value="5">5K</option>
                                <option value="10">10K</option>
                                <option value="21.0975">í•˜í”„</option>
                                <option value="42.195" selected>í’€ì½”ìŠ¤</option>
                            </select>
                        </div>
                        <div class="col" style="flex:1.2">
                            <label>ëª©í‘œ ê¸°ë¡ ì„¤ì •</label>
                            <div class="time-picker-group">
                                <div class="time-select-wrapper">
                                    <select id="tarH" onchange="updateAll()"></select><span class="time-label">h</span>
                                </div>
                                <div class="time-select-wrapper">
                                    <select id="tarM" onchange="updateAll()"></select><span class="time-label">m</span>
                                </div>
                                <div class="time-select-wrapper">
                                    <select id="tarS" onchange="updateAll()"></select><span class="time-label">s</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <label style="margin-top:20px;">í›ˆë ¨ ê¸°ê°„ ì„ íƒ</label>
                    <div class="preset-group">
                        <button type="button" class="preset-btn" id="btn8" onclick="selectPreset(8, this)">8ì£¼<br>(ë‹¨ê¸°)<span class="rec-badge">ì¶”ì²œ</span></button>
                        <button type="button" class="preset-btn active" id="btn12" onclick="selectPreset(12, this)">12ì£¼<br>(í‘œì¤€)<span class="rec-badge">ì¶”ì²œ</span></button>
                        <button type="button" class="preset-btn" id="btn16" onclick="selectPreset(16, this)">16ì£¼<br>(ì‹¬í™”)<span class="rec-badge">ì¶”ì²œ</span></button>
                        <button type="button" class="preset-btn" id="btnAuto" onclick="selectPreset('auto', this)">ëŒ€íšŒì¼ê¹Œì§€<br>(Auto)</button>
                    </div>
                    
                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col">
                            <label>ëŒ€íšŒ ë‚ ì§œ</label>
                            <input type="date" id="raceDate" onchange="enableCustomMode()">
                        </div>
                    </div>

                    <!-- í”¼ë“œë°± ë©”ì‹œì§€ -->
                    <div id="goalFeedback" class="feedback-box">
                        <span>ğŸ¯ ê¸°ë¡ì„ ì…ë ¥í•˜ë©´ AIê°€ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.</span>
                    </div>

                    <!-- ê³¼í•™ì  ê·¼ê±° ì•ˆë‚´ -->
                    <div class="science-info">
                        <strong>ğŸ“š ê³¼í•™ì  ê·¼ê±° ë° ì•ˆë‚´ (Scientific Basis)</strong>
                        <ul>
                            <li><strong>ê¸°ë¡ ì˜ˆì¸¡:</strong> Peter Riegelì˜ ê³µì‹ ($T_2 = T_1 \times (D_2/D_1)^{1.06}$)ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚°ì¶œë©ë‹ˆë‹¤. ì´ëŠ” ì„¸ê³„ì ì¸ ëŸ¬ë‹ ë§¤ê±°ì§„ 'Runner's World'ì˜ í‘œì¤€ ì˜ˆì¸¡ ëª¨ë¸ì…ë‹ˆë‹¤.</li>
                            <li><strong>ì¶”ì²œ ë¡œì§:</strong> 8, 12, 16ì£¼ ê°ê°ì˜ ì˜ˆìƒ ì„±ì¥í­ì„ ê³„ì‚°í•˜ì—¬, ëª©í‘œ ë‹¬ì„±ì´ ê°€ëŠ¥í•œ <strong>'ìµœì†Œ í›ˆë ¨ ê¸°ê°„'</strong>ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</li>
                        </ul>
                    </div>

                </div>

                <!-- 3. ë¹ˆë„ ì„¤ì • -->
                <div class="form-section">
                    <div class="section-title">3. Schedule (í›ˆë ¨ ë¹ˆë„)</div>
                    <select id="freq" onchange="updateAll()">
                        <option value="3">ì£¼ 3íšŒ (ìœ ì§€/ê±´ê°•) - ì„±ì¥ë¥  ë‚®ìŒ</option>
                        <option value="4" selected>ì£¼ 4íšŒ (ê¸°ë¡í–¥ìƒ ê¶Œì¥) - í‘œì¤€ ì„±ì¥</option>
                        <option value="5">ì£¼ 5íšŒ (ì—˜ë¦¬íŠ¸/Sub-3) - ì„±ì¥ë¥  ë†’ìŒ</option>
                    </select>
                </div>

                <button type="button" class="cta" onclick="generateAndGoToSummary()">í”„ë¡œê·¸ë¨ ìƒì„±í•˜ê¸°</button>
            </form>
        </div>

        <!-- [VIEW 2] ìš”ì•½ í™”ë©´ -->
        <div id="view-summary" class="hidden">
            <div class="summary-card">
                <span class="sub-stat" id="sumTitle">ëª©í‘œ ì„¤ì • ê¸°ë¡</span>
                <span class="big-stat" id="sumTargetTime">00:00:00</span>
                
                <!-- ìš”ì•½ ì •ë³´ í–‰ -->
                <div class="summary-info-row">
                    <span><span class="badge" style="background:var(--primary); color:white;">VDOT <span id="sumVdot">00</span></span></span>
                    <span>í›ˆë ¨ê¸°ê°„: <b style="color:#333" id="sumWeeks">00ì£¼</b></span>
                    <span>ëŒ€íšŒê¹Œì§€: <b style="color:#333" id="sumDday">D-00</b></span>
                </div>
            </div>

            <div class="section-title">ğŸƒ Training Paces (ëª©í‘œ ë‹¬ì„±ìš©)</div>
            <div class="pace-grid">
                <div class="pace-card">
                    <div class="pace-label"><div class="dot" style="background:var(--success)"></div>Easy (ì¡°ê¹…)</div>
                    <div class="pace-value" id="paceEasy">-</div>
                </div>
                <div class="pace-card">
                    <div class="pace-label"><div class="dot" style="background:var(--primary)"></div>Race Pace (ëª©í‘œ)</div>
                    <div class="pace-value" id="paceMarathon">-</div>
                </div>
                <div class="pace-card">
                    <div class="pace-label"><div class="dot" style="background:var(--warning)"></div>Threshold (ì—­ì¹˜)</div>
                    <div class="pace-value" id="paceThreshold">-</div>
                </div>
                <div class="pace-card">
                    <div class="pace-label"><div class="dot" style="background:var(--danger)"></div>Interval (ìŠ¤í”¼ë“œ)</div>
                    <div class="pace-value" id="paceInterval">-</div>
                </div>
            </div>

            <button type="button" class="cta" onclick="goToDetail()">ìƒì„¸ í›ˆë ¨ ë‚´ì—­ ë³´ê¸°</button>
            <button type="button" class="secondary-btn" onclick="goToHome()">ì¡°ê±´ ë‹¤ì‹œ ì„¤ì •í•˜ê¸°</button>
        </div>

        <!-- [VIEW 3] ìƒì„¸ í™”ë©´ -->
        <div id="view-detail" class="hidden">
            <div style="margin-bottom:20px;">
                <h3 style="margin:0;">ğŸ“… ì£¼ì°¨ë³„ í›ˆë ¨ ë¡œë“œë§µ</h3>
                <p style="color:#666; font-size:0.9rem;">
                    ì´ <span id="detailTotalWeeks">0</span>ì£¼ / <span id="detailTarget"></span> ëª©í‘œ
                </p>
            </div>

            <div class="timeline-container" id="timelineArea"></div>
            <button type="button" class="secondary-btn" onclick="goToSummary()">â† ìš”ì•½ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentTrainingWeeks = 12; // í˜„ì¬ ì‚¬ìš©ìê°€ 'ì„ íƒí•œ' ì£¼ì°¨
        let recTrainingWeeks = 12;     // AIê°€ 'ì¶”ì²œí•˜ëŠ”' ì£¼ì°¨ (ê³ ì •)

        window.onload = function() {
            initTimeSelects();
            selectPreset(12, document.getElementById('btn12')); // ì´ˆê¸° 12ì£¼ ì„¤ì •
            updateAll(); // ì´ˆê¸° ë¶„ì„
        }

        // --- [Initialization] ---
        function initTimeSelects() {
            const createOpts = (el, max) => {
                for(let i=0; i<=max; i++) el.add(new Option(i, i));
            };
            
            createOpts(document.getElementById('curH'), 9);
            createOpts(document.getElementById('curM'), 59);
            createOpts(document.getElementById('curS'), 59);
            document.getElementById('curM').value = 57;

            createOpts(document.getElementById('tarH'), 9);
            createOpts(document.getElementById('tarM'), 59);
            createOpts(document.getElementById('tarS'), 59);
        }

        // --- [Master Update Function] ---
        function updateAll() {
            const inputs = getInputs();
            if(!inputs) return;

            // 1. ì¶”ì²œ ì£¼ì°¨ ê³„ì‚° (ê³ ì • ë¡œì§)
            const recommendation = calculateRecommendation(inputs);
            updateRecommendationBadge(recommendation);

            // 2. í˜„ì¬ ì„ íƒëœ ì£¼ì°¨ì— ëŒ€í•œ í”¼ë“œë°± (ê°€ë³€ ë¡œì§)
            updateFeedbackBox(inputs);
        }

        function getInputs() {
            const curDist = parseFloat(document.getElementById('currentDist').value);
            const curH = parseInt(document.getElementById('curH').value) || 0;
            const curM = parseInt(document.getElementById('curM').value) || 0;
            const curS = parseInt(document.getElementById('curS').value) || 0;
            const curSec = (curH*3600) + (curM*60) + curS;

            const targetDist = parseFloat(document.getElementById('targetDist').value);
            const tarH = parseInt(document.getElementById('tarH').value) || 0;
            const tarM = parseInt(document.getElementById('tarM').value) || 0;
            const tarS = parseInt(document.getElementById('tarS').value) || 0;
            const targetSec = (tarH*3600) + (tarM*60) + tarS;

            const freq = parseInt(document.getElementById('freq').value) || 4;

            if(curSec === 0) return null;

            return { curDist, curSec, targetDist, targetSec, freq };
        }

        // --- [Logic 1] ì¶”ì²œ ê³„ì‚° ---
        function calculateRecommendation(data) {
            const equivalentSec = data.curSec * Math.pow((data.targetDist / data.curDist), 1.06);
            let freqMultiplier = 1.0;
            if (data.freq === 3) freqMultiplier = 0.8;
            else if (data.freq === 5) freqMultiplier = 1.2;

            const baseRate = 0.0025; 
            const predict = (weeks) => equivalentSec * (1 - (weeks * baseRate * freqMultiplier));

            const pred8 = predict(8);
            const pred12 = predict(12);
            
            if(data.targetSec === 0) return 12;

            const margin = 1.01; 
            if (pred8 <= data.targetSec * margin) return 8;   
            if (pred12 <= data.targetSec * margin) return 12; 
            return 16; 
        }

        function updateRecommendationBadge(recWeeks) {
            document.querySelectorAll('.rec-badge').forEach(b => b.style.display = 'none');
            let btnId = "btn16"; 
            if(recWeeks === 8) btnId = "btn8";
            else if(recWeeks === 12) btnId = "btn12";
            
            const btn = document.getElementById(btnId);
            if(btn) {
                const badge = btn.querySelector('.rec-badge');
                badge.style.display = 'inline-block';
                badge.innerText = "AI ì¶”ì²œ";
            }
        }

        // --- [Logic 2] í”¼ë“œë°± í‘œì‹œ ---
        function updateFeedbackBox(data) {
            const equivalentSec = data.curSec * Math.pow((data.targetDist / data.curDist), 1.06);
            let freqMultiplier = 1.0;
            if (data.freq === 3) freqMultiplier = 0.8;
            else if (data.freq === 5) freqMultiplier = 1.2;

            const improvementFactor = currentTrainingWeeks * 0.0025 * freqMultiplier;
            const predictedSec = equivalentSec * (1 - improvementFactor);

            const ph = Math.floor(predictedSec / 3600);
            const pm = Math.floor((predictedSec % 3600) / 60);
            const ps = Math.floor(predictedSec % 60);
            const recTimeStr = (ph > 0 ? `${ph}ì‹œê°„ ` : "") + `${pm}ë¶„ ${ps}ì´ˆ`;

            const box = document.getElementById('goalFeedback');
            
            if(data.targetSec === 0) {
                box.className = "feedback-box";
                box.innerHTML = `
                    <span>ğŸ¤– ì„ íƒí•œ <strong>${currentTrainingWeeks}ì£¼</strong> í›ˆë ¨ ì‹œ ì˜ˆìƒ ê¸°ë¡:</span>
                    <div class="rec-time-display">${recTimeStr}</div>
                `;
                return;
            }

            const diffRatio = (predictedSec - data.targetSec) / predictedSec;
            let msg = "";
            let cssClass = "feedback-box";

            if (diffRatio <= -0.02) {
                msg = `ğŸ‘ ${currentTrainingWeeks}ì£¼ëŠ” ëª©í‘œ ë‹¬ì„±ì— ì•„ì£¼ ì¶©ë¶„í•œ ê¸°ê°„ì…ë‹ˆë‹¤.`;
                cssClass += " safe";
            } else if (diffRatio <= 0.015) {
                msg = `ğŸ‘Œ ${currentTrainingWeeks}ì£¼ëŠ” ëª©í‘œ ë‹¬ì„±ì— ë”± ì ì ˆí•œ ê¸°ê°„ì…ë‹ˆë‹¤.`;
                cssClass += " safe";
            } else if (diffRatio <= 0.05) {
                msg = `ğŸ”¥ ${currentTrainingWeeks}ì£¼ëŠ” ì•½ê°„ ë„ì „ì ì…ë‹ˆë‹¤. (ì„±ì‹¤í•œ í›ˆë ¨ í•„ìˆ˜)`;
                cssClass += " challenge";
            } else {
                msg = `âš ï¸ ${currentTrainingWeeks}ì£¼ë¡œëŠ” ëª©í‘œ ë‹¬ì„±ì´ ì–´ë µìŠµë‹ˆë‹¤. ê¸°ê°„ì„ ëŠ˜ë¦¬ì„¸ìš”!`;
                cssClass += " danger";
            }

            box.className = cssClass;
            box.innerHTML = `
                <span>${msg}</span>
                <div style="font-size:0.85rem; color:#555; margin-top:5px; border-top:1px solid rgba(0,0,0,0.1); padding-top:5px;">
                    í˜„ì¬ ì„ íƒ(${currentTrainingWeeks}ì£¼) ì˜ˆìƒ: <strong>${recTimeStr}</strong>
                </div>
            `;
        }

        // --- [Interaction] ---
        function selectPreset(weeks, btn) {
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            if (weeks === 'auto') {
                const raceDateVal = document.getElementById('raceDate').value;
                if(!raceDateVal) {
                    const d = new Date();
                    d.setMonth(d.getMonth() + 3);
                    document.getElementById('raceDate').valueAsDate = d;
                    currentTrainingWeeks = 12; 
                } else {
                    const d = new Date(raceDateVal);
                    const today = new Date();
                    const diff = Math.ceil((d - today) / (1000 * 60 * 60 * 24));
                    currentTrainingWeeks = Math.floor(diff / 7);
                }
            } else {
                currentTrainingWeeks = weeks;
                const d = new Date();
                d.setDate(d.getDate() + (weeks * 7));
                document.getElementById('raceDate').valueAsDate = d;
            }
            updateAll(); 
        }

        function enableCustomMode() {
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btnAuto').classList.add('active');
            
            const raceDateVal = document.getElementById('raceDate').value;
            if(raceDateVal) {
                const d = new Date(raceDateVal);
                const today = new Date();
                const diff = Math.ceil((d - today) / (1000 * 60 * 60 * 24));
                currentTrainingWeeks = Math.max(1, Math.floor(diff / 7));
                updateAll();
            }
        }

        // --- [Navigation & Generation] ---
        function formatPace(sec) {
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return `${m}'${s.toString().padStart(2,'0')}"`;
        }
        function secondsToTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return (h>0 ? h+":" : "") + m.toString().padStart(2,'0') + ":" + s.toString().padStart(2,'0');
        }

        function switchView(viewId) {
            ['view-home', 'view-summary', 'view-detail'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
                document.getElementById(id).classList.remove('fade-in');
            });
            const t = document.getElementById(viewId);
            t.classList.remove('hidden');
            t.classList.add('fade-in');
            
            // í˜ì´ì§€ë³„ íƒ€ì´í‹€ ë³€ê²½
            const subtitle = document.getElementById('pageSubtitle');
            if(viewId === 'view-home') subtitle.innerText = "ë‚˜ë§Œì˜ ë§ì¶¤í˜• í›ˆë ¨ í”„ë¡œê·¸ë¨ ì„¤ì •";
            else if(viewId === 'view-summary') subtitle.innerText = "ê³¼í•™ì  ë°ì´í„° ë¶„ì„ ê²°ê³¼";
            else if(viewId === 'view-detail') subtitle.innerText = "ë‹¨ê³„ë³„ í›ˆë ¨ ìŠ¤ì¼€ì¤„";

            window.scrollTo(0,0);
        }
        function goToHome() { switchView('view-home'); }
        function goToSummary() { switchView('view-summary'); }
        function goToDetail() { switchView('view-detail'); }

        function generateAndGoToSummary() {
            let inputs = getInputs();
            if(!inputs) { alert("ì…ë ¥ ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”."); return; }

            // [Smart UX] ëª©í‘œ ê¸°ë¡ì´ 0ì´ë©´ ìë™ ì„¤ì •
            if(inputs.targetSec === 0) {
                // í˜„ì¬ ì„¤ì •ëœ ê°’ë“¤ë¡œ ì˜ˆìƒ ê¸°ë¡ ê³„ì‚°
                const equivalentSec = inputs.curSec * Math.pow((inputs.targetDist / inputs.curDist), 1.06);
                let freqMultiplier = 1.0;
                if (inputs.freq === 3) freqMultiplier = 0.8;
                else if (inputs.freq === 5) freqMultiplier = 1.2;

                const improvementFactor = currentTrainingWeeks * 0.0025 * freqMultiplier;
                const predictedSec = equivalentSec * (1 - improvementFactor);
                
                // inputs ê°ì²´ ì—…ë°ì´íŠ¸
                inputs.targetSec = Math.floor(predictedSec);

                // UI ì—…ë°ì´íŠ¸ (Select Box ë°˜ì˜)
                const h = Math.floor(inputs.targetSec / 3600);
                const m = Math.floor((inputs.targetSec % 3600) / 60);
                const s = Math.floor(inputs.targetSec % 60);
                document.getElementById('tarH').value = h;
                document.getElementById('tarM').value = m;
                document.getElementById('tarS').value = s;

                // ì•ˆë‚´
                alert(`ëª©í‘œ ê¸°ë¡ì„ ì…ë ¥í•˜ì§€ ì•Šì•„,\n${currentTrainingWeeks}ì£¼ í›ˆë ¨ ì‹œ ì˜ˆìƒë˜ëŠ” [${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ]ë¡œ ìë™ ì„¤ì •í•©ë‹ˆë‹¤.`);
            }

            const diffDays = Math.ceil((new Date(document.getElementById('raceDate').value) - new Date()) / (1000 * 60 * 60 * 24));
            if(isNaN(diffDays) || diffDays <= 0) { alert("ëŒ€íšŒ ë‚ ì§œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
            
            const totalWeeks = Math.floor(diffDays / 7);

            // Paces Calculation
            const targetPaceSec = inputs.targetSec / inputs.targetDist;
            const paceEasy = targetPaceSec * 1.25; 
            const paceThreshold = targetPaceSec * 0.92; 
            const paceInterval = targetPaceSec * 0.86; 

            // VDOT Score
            const equiv10kSec = inputs.targetSec * Math.pow((10/inputs.targetDist), 1.06);
            const vdotScore = (1000 / (equiv10kSec/60) * 2.5).toFixed(1);

            let targetLabel = "Full Marathon";
            if(inputs.targetDist === 5) targetLabel = "5K Race";
            else if(inputs.targetDist === 10) targetLabel = "10K Race";
            else if(inputs.targetDist === 21.0975) targetLabel = "Half Marathon";

            // UI Update (View 2)
            document.getElementById('sumTitle').innerText = `${targetLabel} ëª©í‘œ`;
            document.getElementById('sumTargetTime').innerText = secondsToTime(inputs.targetSec);
            document.getElementById('sumVdot').innerText = vdotScore;
            
            document.getElementById('sumWeeks').innerText = `${totalWeeks}ì£¼`;
            document.getElementById('sumDday').innerText = `D-${diffDays}`;

            document.getElementById('paceEasy').innerText = formatPace(paceEasy) + "/km";
            document.getElementById('paceMarathon').innerText = formatPace(targetPaceSec) + "/km";
            document.getElementById('paceThreshold').innerText = formatPace(paceThreshold) + "/km";
            document.getElementById('paceInterval').innerText = formatPace(paceInterval) + "/km";

            // Generate Timeline (View 3 Data)
            renderTimeline(totalWeeks, inputs.freq, inputs.targetDist);
            document.getElementById('detailTotalWeeks').innerText = totalWeeks;
            document.getElementById('detailTarget').innerText = targetLabel;

            // Transition
            goToSummary();
        }

        function renderTimeline(weeks, freq, targetDist) {
            const container = document.getElementById('timelineArea');
            container.innerHTML = "";
            if (weeks < 4) {
                container.innerHTML = "<div class='phase-card phase-taper'>ê¸°ê°„ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë¶€ìƒ ì¡°ì‹¬í•˜ì„¸ìš”.</div>";
                return;
            }
            let taper = 2;
            let peak = Math.max(2, Math.floor(weeks * 0.25));
            let build = Math.max(3, Math.floor(weeks * 0.35));
            let base = weeks - (taper + peak + build);
            if (base < 1) { base = 1; build = weeks - (taper + peak + base); }

            let focusText = "";
            if (targetDist <= 10) focusText = "ìŠ¤í”¼ë“œ ë° ì¸í„°ë²Œ";
            else if (targetDist > 21) focusText = "ì§€êµ¬ë ¥ ë° ê±°ë¦¬ì£¼";
            else focusText = "ì§€ì†ì£¼";

            const addCard = (type, name, duration, desc) => {
                const html = `
                    <div class="phase-card ${type}">
                        <div class="phase-header"><span class="phase-name">${name}</span><span class="phase-weeks">${duration}ì£¼ê°„</span></div>
                        <div class="phase-desc">${desc}</div>
                    </div>`;
                container.innerHTML += html;
            };
            addCard('phase-base', '1. Base', base, `Easy Run ìœ„ì£¼ ${focusText} ê¸°ì´ˆ ë‹¤ì§€ê¸°.`);
            addCard('phase-build', '2. Build', build, `ë§ˆì¼ë¦¬ì§€ ì¦ê°€ ë° ëª©í‘œ í˜ì´ìŠ¤ ì ì‘ í›ˆë ¨.`);
            addCard('phase-peak', '3. Peak', peak, `ìµœëŒ€ ê°•ë„ í›ˆë ¨. ì‹¤ì „ ëª¨ì˜ê³ ì‚¬.`);
            addCard('phase-taper', '4. Taper', taper, `í›ˆë ¨ëŸ‰ 50% ê°ì†Œ. ì»¨ë””ì…˜ ì¡°ì ˆ.`);
        }
    </script>
</body>
</html>
